function init(t,e){"use strict";game=new pacman.PacmanGame({parent:t,width:CANVAS_WIDTH,height:CANVAS_HEIGHT,assetRoot:e,keyRefreshMillis:300,targetFps:60}),game.setState(new pacman.LoadingState),game.start()}var CANVAS_WIDTH=224,CANVAS_HEIGHT=288,game,gtp;!function(t){"use strict";var e=function(){function e(){this._paused=!1,this._pauseStart=0,this._updating=!0,this._notUpdatingStart=0}return Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(e){if(this._paused!==e)if(this._paused=e,e)this._pauseStart=t.Utils.timestamp();else{var i=t.Utils.timestamp()-this._pauseStart;this._startShift+=i,this._pauseStart=0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playTime",{get:function(){return 0!==this._pauseStart?this._pauseStart-this._startShift:0!==this._notUpdatingStart?this._notUpdatingStart-this._startShift:t.Utils.timestamp()-this._startShift},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updating",{get:function(){return this._updating},set:function(e){if(this._updating!==e&&(this._updating=e,!this.paused))if(this._updating){var i=t.Utils.timestamp()-this._notUpdatingStart;this._startShift+=i,this._notUpdatingStart=0}else this._notUpdatingStart=t.Utils.timestamp()},enumerable:!0,configurable:!0}),e.prototype.resetPlayTime=function(){if(this.paused||!this.updating)throw"Cannot reset playtime millis when paused or not updating";this._startShift=t.Utils.timestamp()},e.prototype.start=function(){this._startShift=t.Utils.timestamp()},e}();t._GameTimer=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function t(){}return t.getWindowLocationSearch=function(){return window.location.search},t}();t.BrowserUtil=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.equals=function(t){return null!=t&&this.x===t.x&&this.y===t.y},t}();t.Point=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function t(t,e,i,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),this.set(t,e,i,s)}return t.prototype.intersects=function(t){var e=this.w,i=this.h,s=t.w,n=t.h;if(0>=s||0>=n||0>=e||0>=i)return!1;var o=this.x,a=this.y,r=t.x,h=t.y;return s+=r,n+=h,e+=o,i+=a,(r>s||s>o)&&(h>n||n>a)&&(o>e||e>r)&&(a>i||i>h)},t.prototype.set=function(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s},t}();t.Rectangle=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function t(t,e,i){void 0===e&&(e=20),void 0===i&&(i=10),this._c=t,this._pool=[];for(var s=0;e>s;s++)this._pool.push(new this._c);this._index=0,this._growCount=i}return t.prototype.borrowObj=function(){var t=this._pool[this._index++];if(this._index>=this._pool.length)for(var e=0;e<this._growCount;e++)this._pool.push(new this._c);return t},Object.defineProperty(t.prototype,"borrowedCount",{get:function(){return this._index},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._index=0},t.prototype.returnObj=function(t){for(var e=-1,i=0;i<this._index;i++)if(t===this._pool[i]){e=i;break}if(-1===e)return!1;var s=this._pool[--this._index];return this._pool[this._index]=this._pool[e],this._pool[e]=s,!0},Object.defineProperty(t.prototype,"length",{get:function(){return this._pool.length},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"[gtp.Pool: borrowed="+this.borrowedCount+", size="+this.length+"]"},t}();t.Pool=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function e(){}return e.getObjectSize=function(t){var e=0;for(var i in t)t.hasOwnProperty(i)&&e++;return e},e.getRequestParam=function(e){var i="&"+t.BrowserUtil.getWindowLocationSearch().substring(1),s="&"+e,n=i.indexOf(s);if(n>=-1){var o=n+s.length;if("="===i.charAt(o)){o++;var a=i.indexOf("&",o);return-1===a&&(a=i.length),i.substring(o,a)}if("&"===i.charAt(o))return"";if(o===i.length)return""}return null},e.hitch=function(t,e){return function(){e.apply(t,arguments)}},e.mixin=function(t,e){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e.randomInt=function(t,e){var i,s;return"undefined"==typeof e?(i=0,s=t):(i=t,s=e),Math.floor(Math.random()*(s-i))+i},e.timestamp=function(){return window.performance&&window.performance.now?window.performance.now():Date.now()},e.initConsole=function(){if(!window.console){var t=function(){};window.console={info:t,log:t,warn:t,error:t}}},e}();t.Utils=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function e(){}return e.resize=function(e,i){void 0===i&&(i=1);var s,n;if(e instanceof HTMLImageElement?(s=t.ImageUtils.createCanvas(e.width,e.height),n=s.getContext("2d"),n.drawImage(e,0,0)):(s=e,n=s.getContext("2d")),1===i)return s;for(var o=n.getImageData(0,0,e.width,e.height),a=e.width*i,r=e.height*i,h=t.ImageUtils.createCanvas(a,r),c=h.getContext("2d"),u=c.getImageData(0,0,a,r),p=0;r>p;p++)for(var l=0;a>l;l++){var d=4*(Math.floor(p/i)*e.width+Math.floor(l/i)),g=4*(p*a+l);u.data[g]=o.data[d],u.data[g+1]=o.data[d+1],u.data[g+2]=o.data[d+2],u.data[g+3]=o.data[d+3]}return c.putImageData(u,0,0),h},e.createCanvas=function(e,i,s){var n=document.createElement("canvas");if(n.width=e,n.height=i,t.ImageUtils.prepCanvas(n),s){var o;o="string"==typeof s?document.getElementById(s):s,o.innerHTML="",o.appendChild(n)}return n},e.prepCanvas=function(t){var e=t.getContext("2d");e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1},e.makeColorTranslucent=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);for(var s=t.getContext("2d"),n=t.width,o=t.height,a=s.getImageData(0,0,n,o),r=[],h=4*(i*n+e),c=0;4>c;c++)r[c]=a.data[h+c];for(i=0;o>i;i++)for(e=0;n>e;e++){var u=4*(i*n+e);a.data[u]===r[0]&&a.data[u+1]===r[1]&&a.data[u+2]===r[2]&&a.data[u+3]===r[3]&&(a.data[u]=0,a.data[u+1]=0,a.data[u+2]=0,a.data[u+3]=0)}return s.putImageData(a,0,0),t},e.allowSubpixelImageRendering=!1,e}();t.ImageUtils=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function e(){this._startTimes={},this._prefix="DEBUG"}return e.prototype.setLogPrefix=function(t){void 0===t&&(t="DEBUG"),this._prefix=t},e.prototype.start=function(e){this._startTimes[e]=t.Utils.timestamp()},e.prototype.end=function(e){var i=this._startTimes[e];if(!i)return console.error('Cannot end timer for "'+e+'" as it was never started'),-1;var s=t.Utils.timestamp()-i;return delete this._startTimes[e],s},e.prototype.endAndLog=function(t){var e=this.end(t);e>-1&&console.log(this._prefix+": "+t+": "+e+" ms")},e}();t.Timer=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function t(t){if(!t||!t.millis)throw'Missing required "millis" argument to gtp.Delay';this._initial=t.millis.length?t.millis:[t.millis],this._initialIndex=0,t.minDelta&&t.maxDelta&&this.setRandomDelta(t.minDelta,t.maxDelta),this._callback=t.callback,this._loop=!!t.loop,this._loopCount=0,this._maxLoopCount=this._loop?t.loopCount||-1:-1,this.reset()}return t.prototype.update=function(t){return this._remaining>0&&(this._remaining-=t,this._remaining<=0&&this._callback&&this._callback(this)),this._remaining<=0&&(this._loop?-1===this._maxLoopCount||this._loopCount<this._maxLoopCount-1?(this._loopCount++,this.reset(!0)):(this._loopCount=this._maxLoopCount,this._remaining=-1):this._remaining=Math.max(0,this._remaining)),this.isDone()},t.prototype.getLoopCount=function(){return this._loopCount},t.prototype.getMaxDelta=function(){return"undefined"!=typeof this._maxDelta?this._maxDelta:-1},t.prototype.getMinDelta=function(){return"undefined"!=typeof this._minDelta?this._minDelta:-1},t.prototype.getRemaining=function(){return this._remaining},t.prototype.getRemainingPercent=function(){return this._remaining/this._curInitial},t.prototype.isDone=function(){return(!this._loop||this._loopCount===this._maxLoopCount)&&this._remaining<=0},t.prototype.setRandomDelta=function(t,e){this._minDelta=t,this._maxDelta=e},t.prototype.reset=function(t){t=!!t;var e=this._remaining;this._curInitial=this._remaining=this._initial[this._initialIndex],t&&0>e&&(this._remaining+=e),this._initialIndex=(this._initialIndex+1)%this._initial.length,this._minDelta||this._maxDelta},t.prototype.toString=function(){return"[gtp.Delay: _initial="+this._initial+", _remaining="+this._remaining+", _loop="+this._loop+", _callback="+(null!=this._callback)+"]"},t}();t.Delay=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function e(t,e,i,s,n){this._canvas=t,null!=e&&null!=i&&null!=s&&null!=n?(this.x=e,this.y=i,this._width=s,this._height=n):(this.x=this.y=0,this._width=this._canvas.width,this._height=this._canvas.height),this._ensure256Square()}return e.prototype._ensure256Square=function(){if(this._canvas.width<256||this._canvas.height<256){var e=Math.max(256,this._canvas.width),i=Math.max(256,this._canvas.height),s=t.ImageUtils.createCanvas(e,i),n=s.getContext("2d");n.drawImage(this._canvas,0,0),this._canvas=s}},e.prototype.draw=function(e,i,s){t.ImageUtils.allowSubpixelImageRendering||(i=Math.round(i),s=Math.round(s)),e.drawImage(this._canvas,this.x,this.y,this._width,this._height,i,s,this._width,this._height)},e.prototype.drawScaled=function(e,i,s,n,o){t.ImageUtils.allowSubpixelImageRendering||(i=Math.round(i),s=Math.round(s)),e.drawImage(this._canvas,this.x,this.y,this._width,this._height,i,s,n,o)},e.prototype.drawScaled2=function(e,i,s,n,o,a,r,h,c){t.ImageUtils.allowSubpixelImageRendering||(i=Math.round(i),s=Math.round(s),a=Math.round(a),r=Math.round(r)),i=this.x+i,s=this.y+s,e.drawImage(this._canvas,i,s,n,o,a,r,h,c)},e.prototype.makeColorTranslucent=function(e,i){void 0===e&&(e=0),void 0===i&&(i=0),t.ImageUtils.makeColorTranslucent(this._canvas,e,i)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e}();t.Image=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function e(e){this._atlasInfo=e.atlasInfo,this._masterCanvas=e.canvas,this._atlasInfo.firstPixelIsTranslucent&&(this._masterCanvas=t.ImageUtils.makeColorTranslucent(this._masterCanvas))}return e.prototype.parse=function(){var e={},i=this;return this._atlasInfo.images.forEach(function(s){var n,o=s.id;if(s.dim){if(n=s.dim.split(/,\s*/),4!==n.length)throw new Error("Invalid value for imgInfo.dim: "+s.dim)}else n=[],n.push(s.x,s.y,s.w,s.h);n=n.map(function(t){return 2*parseInt(t,10)}),e[o]=new t.Image(i._masterCanvas,n[0],n[1],n[2],n[3])}),e},e}();t.ImageAtlas=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function t(t){this._config=t,this._paused=!1}return t.prototype._initFromConfig=function(){if(this.id=this._config.id,this.soundId=this._config.soundId,this.source=this._config.audioSystem.context.createBufferSource(),this.source.loop=this._config.loop,this.source.buffer=this._config.buffer,this._config.connectTo instanceof AudioNode)this.source.connect(this._config.connectTo);else{var t=this._config.connectTo;t.forEach(function(t){this.source.connect(t)})}if(this._startOffset=this._config.startOffset||0,!this._config.loop){var e=this;this._config.audioSystem;this.source.onended=this._config.onendedGenerator(e.id)}},t.prototype.pause=function(){this._paused||(this.source.stop(),this._playedTime+=this.source.context.currentTime-this._start,this._paused=!0,this._start=0)},t.prototype.resume=function(){if(this._paused){this._paused=!1;var t=this._startOffset;this._initFromConfig(),this._startOffset=t+this._playedTime,this._startOffset=this._startOffset%this.source.buffer.duration;var e=this.source.context.currentTime;this.source.start(e,this._startOffset),this._start=e,this._playedTime=0}},t.prototype.start=function(){this._paused=!1,this._initFromConfig();var t=this.source.context.currentTime;this.source.start(t,this._startOffset),this._start=t,this._playedTime=0},t}(),i=function(){function t(){this._currentMusic=null,this._sounds={},this._musicFade=.3,this._fadeMusic=!0,this._muted=!1,this._playingSounds=[],this._soundEffectIdGenerator=0}return t.prototype._createPlayingSound=function(t,i,s,n){void 0===i&&(i=!1),void 0===s&&(s=0),void 0===n&&(n=null);var o=this,a=this._createSoundEffectId(),r=new e({audioSystem:this,buffer:this._sounds[t].getBuffer(),connectTo:this._volumeFaderGain,id:a,loop:i,onendedGenerator:function(e){return function(){o._removePlayingSound(e),n&&n(a,t)}},soundId:t,startOffset:s});return r},t.prototype._createSoundEffectId=function(){return this._soundEffectIdGenerator++},t.prototype.init=function(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext,this.context=new window.AudioContext,this._volumeFaderGain=this.context.createGain(),this._volumeFaderGain.gain.setValueAtTime(1,this.context.currentTime),this._volumeFaderGain.gain.value=1,this._volumeFaderGain.connect(this.context.destination),this._initialized=!0}catch(t){console.error("The Web Audio API is not supported in this browser."),this._initialized=!1}},t.prototype.addSound=function(t){this.context&&(this._sounds[t.getId()]=t)},t.prototype.fadeOutMusic=function(t){if(this.context)if(this._currentMusic){this._muted||(this._musicFaderGain.gain.setValueAtTime(this._musicFaderGain.gain.value,this.context.currentTime),this._musicFaderGain.gain.linearRampToValueAtTime(0,this.context.currentTime+this._musicFade));var e=this;setTimeout(function(){e.playMusic(t)},1e3*this._musicFade)}else this.playMusic(t)},t.prototype.getCurrentMusic=function(){return this.currentMusicId},t.prototype.isInitialized=function(){return this._initialized},t.prototype.pauseAll=function(){this._playingSounds.forEach(function(t){t.pause()})},t.prototype.playMusic=function(t,e){if(this.context){if(this._currentMusic&&this.stopMusic(!1),!t)return;var i=this._sounds[t];"undefined"==typeof e&&(e=i.getLoopsByDefaultIfMusic()),this._musicFaderGain=this.context.createGain(),this._musicFaderGain.gain.setValueAtTime(1,this.context.currentTime),this._musicFaderGain.gain.value=1,this._currentMusic=this.context.createBufferSource(),this._currentMusic.loop=e,this._musicLoopStart=i.getLoopStart()||0,this._currentMusic.loopStart=this._musicLoopStart,this._currentMusic.buffer=i.getBuffer(),this._currentMusic.loopEnd=this._currentMusic.buffer.duration,this._currentMusic.connect(this._musicFaderGain),this._musicFaderGain.connect(this._volumeFaderGain),this._currentMusic.start(0),this.currentMusicId=t,console.log("Just started new music with id: "+t+", loop: "+e)}},t.prototype.playSound=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=null),this.context){var s=this._createPlayingSound(t,e,0,i);return this._playingSounds.push(s),s.start(),s.id}return-1},t.prototype._removePlayingSound=function(t){for(var e=0;e<this._playingSounds.length;e++)if(this._playingSounds[e].id===t){var i=this._playingSounds[e];return this._playingSounds.splice(e,1),i}return null},t.prototype.resumeAll=function(){for(var t=0;t<this._playingSounds.length;t++){var e=this._playingSounds[t];e._paused&&e.resume()}},t.prototype.stopMusic=function(t){void 0===t&&(t=!1),this._currentMusic.stop(),t||(this._currentMusic.disconnect(),this._musicFaderGain.disconnect(),delete this._currentMusic,delete this._musicFaderGain)},t.prototype.stopSound=function(t){var e=this._removePlayingSound(t);return e?(e.source.stop(),!0):!1},t.prototype.toggleMuted=function(){if(this._muted=!this._muted,this.context){var t=this._muted?0:1;this._volumeFaderGain.gain.setValueAtTime(t,this.context.currentTime),this._volumeFaderGain.gain.value=t}return this._muted},Object.defineProperty(t.prototype,"fadeMusic",{get:function(){return this._fadeMusic},set:function(t){this._fadeMusic=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"musicFadeSeconds",{get:function(){return this._musicFade},set:function(t){this._musicFade=t},enumerable:!0,configurable:!0}),t}();t.AudioSystem=i}(gtp||(gtp={}));var gtp;!function(t){"use strict";!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.IMAGE=1]="IMAGE",t[t.AUDIO=2]="AUDIO",t[t.JSON=3]="JSON"}(t.AssetType||(t.AssetType={}));t.AssetType}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function e(t,e,i){void 0===t&&(t=1),this._scale=t||1,this.loadingAssetData={},this.responses={},this.callback=null,this.audio=e,this._assetRoot=i}return e.prototype.addJson=function(e,i){if(void 0===i&&(i=e),this._assetRoot&&(i=this._assetRoot+i),!this._isAlreadyTracked(e)){this.loadingAssetData[e]={type:t.AssetType.JSON},console.log("Adding: "+e+" => "+i+", remaining == "+t.Utils.getObjectSize(this.loadingAssetData)+", callback == "+(null!==this.callback));var s=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){var t=n.responseText;s._completed(e,t)}},n.open("GET",i,!0),n.send(null)}},e.prototype.addCanvas=function(e,i){this._assetRoot&&(i=this._assetRoot+i);var s=this,n=document.createElement("img");this._isAlreadyTracked(e)||(this.loadingAssetData[e]={type:t.AssetType.IMAGE},console.log("Adding: "+e+" => "+i+", remaining == "+t.Utils.getObjectSize(this.loadingAssetData)+", callback == "+(null!==this.callback)),n.addEventListener("load",function(){var i=t.ImageUtils.resize(n,s._scale);s._completed(e,i)}),n.src=i)},e.prototype.addImage=function(e,i,s){void 0===s&&(s=!1),this._assetRoot&&(i=this._assetRoot+i);var n=this,o=document.createElement("img");this._isAlreadyTracked(e)||(this.loadingAssetData[e]={type:t.AssetType.IMAGE},console.log("Adding: "+e+" => "+i+", remaining == "+t.Utils.getObjectSize(this.loadingAssetData)+", callback == "+(null!==this.callback)),o.addEventListener("load",function(){var i=t.ImageUtils.resize(o,n._scale),a=new t.Image(i);s&&a.makeColorTranslucent(0,0),n._completed(e,a)}),o.src=i)},e.prototype.addSound=function(e,i,s,n){if(void 0===s&&(s=0),void 0===n&&(n=!0),this.audio.isInitialized()){if(this._isAlreadyTracked(e))return;this.loadingAssetData[e]={type:t.AssetType.AUDIO},this._assetRoot&&(i=this._assetRoot+i);var o=this,a=new XMLHttpRequest;a.onload=function(){o.audio.context.decodeAudioData(a.response,function(i){var a=new t.Sound(e,i,s||0);"undefined"!=typeof n&&a.setLoopsByDefaultIfMusic(n),o.audio.addSound(a),o._completed(e,i)})},a.open("GET",i,!0),a.responseType="arraybuffer",a.send(null)}},e.prototype.addSpriteSheet=function(e,i,s,n,o,a,r){void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r=!1);var h=this;o=o||0,a=a||0,s*=h._scale,n*=h._scale,o*=h._scale,a*=h._scale,this._assetRoot&&(i=this._assetRoot+i);var c=document.createElement("img");this._isAlreadyTracked(e)||(this.loadingAssetData[e]={type:t.AssetType.IMAGE},console.log("Adding: "+e+" => "+i+", remaining == "+t.Utils.getObjectSize(this.loadingAssetData)+", callback == "+(null!==this.callback)),c.addEventListener("load",function(){var i=t.ImageUtils.resize(c,h._scale),u=new t.Image(i);r&&u.makeColorTranslucent(0,0);var p=new t.SpriteSheet(u,s,n,o,a);h._completed(e,p)}),c.src=i)},e.prototype.addTmxMap=function(t){if(t.tilesets&&t.tilesets.length)for(var e=0;e<t.tilesets.length;e++){var i=t.tilesets[e],s="_tilesetImage_"+i.name;this.addImage(s,i.image)}},e.prototype.getTmxTilesetImage=function(t){return this.responses["_tilesetImage_"+t.name]},e.prototype.get=function(t){return this.responses[t]},e.prototype._isAlreadyTracked=function(t){return this.loadingAssetData[t]?(console.log("A resource with id "+t+" is already loading.  Assuming they are the same"),!0):this.responses[t]?(console.log("A resource with id "+t+" has already been loaded."),!0):void 0},e.prototype.set=function(t,e){this.responses[t]=e},e.prototype._completed=function(e,i){return this.loadingAssetData[e]?(this.loadingAssetData[e].type===t.AssetType.JSON&&(i=JSON.parse(i)),this.responses[e]=i,delete this.loadingAssetData[e],console.log("Completed: "+e+", remaining == "+t.Utils.getObjectSize(this.loadingAssetData)+", callback == "+(null!==this.callback)),void(this.isDoneLoading()&&this.callback?(this.callback.call(),delete this.callback,console.log("... Callback called and deleted (callback == "+(null!==this.callback)+")"),this.nextCallback&&(this.callback=this.nextCallback,delete this.nextCallback)):console.log("... Not running callback - "+this.isDoneLoading()+", "+(null!==this.callback)))):void console.error("Resource not found! - "+e)},e.prototype.isDoneLoading=function(){return 0===t.Utils.getObjectSize(this.loadingAssetData)},e.prototype.onLoad=function(t){this.isDoneLoading()?t():this.callback?this.nextCallback=t:this.callback=t},e}();t.AssetLoader=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function t(t,e,i,s,n){void 0===s&&(s=1),void 0===n&&(n=s),this.gtpImage=t,this.cellW=e,this.cellH=i,this.spacingX="undefined"==typeof s?1:s,this.spacingY="undefined"==typeof n?this.spacingX:n,this.rowCount=Math.floor(t.height/(i+this.spacingY)),t.height-this.rowCount*(i+this.spacingY)>=i&&this.rowCount++,this.colCount=Math.floor(t.width/(e+this.spacingX)),t.width-this.colCount*(e+this.spacingX)>=e&&this.colCount++,this.size=this.rowCount*this.colCount}return t.prototype.drawSprite=function(t,e,i,s,n){var o=this.cellW,a=this.cellH,r=(o+this.spacingX)*n,h=(a+this.spacingY)*s;this.gtpImage.drawScaled2(t,r,h,o,a,e,i,o,a)},t.prototype.drawByIndex=function(t,e,i,s){var n=Math.floor(s/this.colCount),o=Math.floor(s%this.colCount);this.drawSprite(t,e,i,n,o)},t}();t.SpriteSheet=e}(gtp||(gtp={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},gtp;!function(t){"use strict";var e=function(t){function e(e,i,s,n,o){t.call(this,e,i,s,n,o)}return __extends(e,t),e.prototype.drawString=function(t,e,i){for(var s=this.size,n=window.game.canvas.getContext("2d"),o=this.cellW,a=0;a<t.length;a++){var r=t.charCodeAt(a)-32;(0>r||r>=s)&&(r=0),this.drawByIndex(n,e,i,r),e+=o}},e}(t.SpriteSheet);t.BitmapFont=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function e(t){this.keys=[],this._refireMillis=t||0,this._repeatTimers=[]}return e.prototype.clearKeyState=function(t){this.keys[t]=!1,this._repeatTimers[t]&&(clearInterval(this._repeatTimers[t]),this._repeatTimers[t]=null)},e.prototype.clearKeyStates=function(){for(var t=0;t<this.keys.length;t++)this.clearKeyState(t)},e.prototype.ctrl=function(e){return void 0===e&&(e=!1),this.isKeyDown(t.Keys.KEY_CTRL,e)},e.prototype.down=function(e){return void 0===e&&(e=!1),this.isKeyDown(t.Keys.KEY_DOWN_ARROW,e)},e.prototype.enter=function(e){return void 0===e&&(e=!1),this.isKeyDown(t.Keys.KEY_ENTER,e)},e.prototype.install=function(){var t=this;document.onkeydown=function(e){t._keyDown(e)},document.onkeyup=function(e){t._keyUp(e)}},e.prototype.isKeyDown=function(t,e){void 0===e&&(e=!1);var i=this.keys[t];return i&&e&&(this.keys[t]=!1),i},e.prototype._keyDown=function(t){var e=t.keyCode;if((32===e||e>=37&&40>=e)&&t.preventDefault(),this._refireMillis){if(!this._repeatTimers[e]){this.keys[e]=!0;var i=this;this._repeatTimers[e]=setInterval(function(){i.keys[e]=!0},i._refireMillis)}}else this.keys[e]=!0;t.stopPropagation()},e.prototype._keyUp=function(t){var e=t.keyCode;this._refireMillis?this._repeatTimers[e]?(this.keys[e]=!1,clearInterval(this._repeatTimers[e]),this._repeatTimers[e]=null):console.error("_keyUp: Timer does not exist for key: "+e+"!"):this.keys[e]=!1,t.stopPropagation()},e.prototype.left=function(e){return void 0===e&&(e=!1),this.isKeyDown(t.Keys.KEY_LEFT_ARROW,e)},e.prototype.right=function(e){return void 0===e&&(e=!1),this.isKeyDown(t.Keys.KEY_RIGHT_ARROW,e)},e.prototype.shift=function(e){return void 0===e&&(e=!1),this.isKeyDown(t.Keys.KEY_SHIFT,e)},e.prototype.up=function(e){return void 0===e&&(e=!1),this.isKeyDown(t.Keys.KEY_UP_ARROW,e)},e}();t.InputManager=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";!function(t){t[t.KEY_ENTER=13]="KEY_ENTER",t[t.KEY_SHIFT=16]="KEY_SHIFT",t[t.KEY_CTRL=17]="KEY_CTRL",t[t.KEY_SPACE=32]="KEY_SPACE",t[t.KEY_LEFT_ARROW=37]="KEY_LEFT_ARROW",t[t.KEY_UP_ARROW=38]="KEY_UP_ARROW",t[t.KEY_RIGHT_ARROW=39]="KEY_RIGHT_ARROW",t[t.KEY_DOWN_ARROW=40]="KEY_DOWN_ARROW",t[t.KEY_0=48]="KEY_0",t[t.KEY_1=49]="KEY_1",t[t.KEY_2=50]="KEY_2",t[t.KEY_3=51]="KEY_3",t[t.KEY_4=52]="KEY_4",t[t.KEY_5=53]="KEY_5",t[t.KEY_6=54]="KEY_6",t[t.KEY_7=55]="KEY_7",t[t.KEY_8=56]="KEY_8",t[t.KEY_9=57]="KEY_9",t[t.KEY_A=65]="KEY_A",t[t.KEY_B=66]="KEY_B",t[t.KEY_C=67]="KEY_C",t[t.KEY_D=68]="KEY_D",t[t.KEY_E=69]="KEY_E",t[t.KEY_F=70]="KEY_F",t[t.KEY_G=71]="KEY_G",t[t.KEY_H=72]="KEY_H",t[t.KEY_I=73]="KEY_I",t[t.KEY_J=74]="KEY_J",t[t.KEY_K=75]="KEY_K",t[t.KEY_L=76]="KEY_L",t[t.KEY_M=77]="KEY_M",t[t.KEY_N=78]="KEY_N",t[t.KEY_O=79]="KEY_O",t[t.KEY_P=80]="KEY_P",t[t.KEY_Q=81]="KEY_Q",t[t.KEY_R=82]="KEY_R",t[t.KEY_S=83]="KEY_S",t[t.KEY_T=84]="KEY_T",t[t.KEY_U=85]="KEY_U",t[t.KEY_V=86]="KEY_V",t[t.KEY_W=87]="KEY_W",t[t.KEY_X=88]="KEY_X",t[t.KEY_Y=89]="KEY_Y",t[t.KEY_Z=90]="KEY_Z"}(t.Keys||(t.Keys={}));t.Keys}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function e(e){void 0===e&&(e={}),t.Utils.initConsole(),this._scale=e.scale||1,this.canvas=t.ImageUtils.createCanvas(e.width,e.height,e.parent),this.inputManager=new t.InputManager(e.keyRefreshMillis||0),this.inputManager.install(),this._targetFps=e.targetFps||30,this._interval=1e3/this._targetFps,this.lastTime=0,this.audio=new t.AudioSystem,this.audio.init();var i=e.assetRoot||null;this.assets=new t.AssetLoader(this._scale,this.audio,i),this.clearScreenColor="rgb(0,0,0)",this.fpsColor="rgb(255,255,255)",this.statusMessageRGB="255,255,255",this._statusMessageColor=null,this.showFps=!1,this.frames=0,this._fpsMsg=this._targetFps+" fps",this._statusMessage=null,this._statusMessageAlpha=0,this._gameTimer=new t._GameTimer,this.timer=new t.Timer}return e.prototype.clearScreen=function(t){void 0===t&&(t=this.clearScreenColor);var e=this.canvas.getContext("2d");e.fillStyle=t,e.fillRect(0,0,this.getWidth(),this.getHeight())},e.prototype.getHeight=function(){return this.canvas.height},e.prototype.getWidth=function(){return this.canvas.width},Object.defineProperty(e.prototype,"paused",{get:function(){return this._gameTimer.paused},set:function(t){t?this.audio.pauseAll():this.audio.resumeAll(),this._gameTimer.paused=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playTime",{get:function(){return this._gameTimer.playTime},enumerable:!0,configurable:!0}),e.prototype.randomInt=function(t){var e=0;return Math.floor(Math.random()*(t-e+1)+e)},e.prototype.render=function(){var t=this.canvas.getContext("2d");this.state.render(t),this.showFps&&this._renderFps(t),this._statusMessage&&this._statusMessageAlpha>0&&this._renderStatusMessage(t)},e.prototype._renderFps=function(e){this.frames++;var i=t.Utils.timestamp();null===this.lastTime?this.lastTime=i:i-this.lastTime>=1e3&&(this._fpsMsg=this.frames+" fps",this.frames=0,this.lastTime=i);var s=10,n=15;e.font="10pt Arial",e.fillStyle=this.fpsColor,e.fillText(this._fpsMsg,s,n)},e.prototype._renderStatusMessage=function(t){var e=10,i=this.canvas.height-6;t.font="10pt Arial",t.fillStyle=this._statusMessageColor,t.fillText(this._statusMessage,e,i)},e.prototype.resetPlayTime=function(){this._gameTimer.resetPlayTime()},e.prototype.setState=function(t){this.state&&this.state.leaving(this),this.state=t,this.state.enter(this)},e.prototype.setStatusMessage=function(e){this._statusMessage=e,this._statusMessageAlpha=2,this._statusMessageTime=t.Utils.timestamp()+100},e.prototype.start=function(){var t=this,e=function(){t._tick.apply(t)};this._gameTimer.start(),setInterval(e,this._interval)},e.prototype._tick=function(){if(this._statusMessage){var e=t.Utils.timestamp();if(e>this._statusMessageTime){this._statusMessageTime=e+100,this._statusMessageAlpha-=.1;var i=Math.min(1,this._statusMessageAlpha);this._statusMessageColor="rgba("+this.statusMessageRGB+","+i+")",this._statusMessageAlpha<=0&&(this._statusMessage=null)}}this.update(),this.render()},e.prototype.toggleMuted=function(){var t=this.audio.toggleMuted();return this.setStatusMessage(t?"Audio muted":"Audio enabled"),t},e.prototype.toggleShowFps=function(){this.showFps=!this.showFps,this.setStatusMessage("FPS display: "+(this.showFps?"on":"off"))},e.prototype.update=function(){var e=this.inputManager;e.isKeyDown(t.Keys.KEY_SHIFT)&&e.isKeyDown(t.Keys.KEY_F,!0)&&this.toggleShowFps(),this.state.update(this._interval)},e}();t.Game=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function t(t,e,i){void 0===i&&(i=0),this._id=t,this._buffer=e,this._loopsByDefault=!0,this._loopStart=i}return t.prototype.getBuffer=function(){return this._buffer},t.prototype.getId=function(){return this._id},t.prototype.getLoopsByDefaultIfMusic=function(){return this._loopsByDefault},t.prototype.setLoopsByDefaultIfMusic=function(t){this._loopsByDefault=t},t.prototype.getLoopStart=function(){return this._loopStart},t.prototype.setLoopStart=function(t){this._loopStart=t},t}();t.Sound=e}(gtp||(gtp={}));var gtp;!function(t){"use strict";var e=function(){function e(e){e instanceof t.Game?this.game=e:e?this.game=e.game:this.game=window.game}return e.prototype.enter=function(t){},e.prototype.leaving=function(t){},e.prototype.update=function(t){},e.prototype.render=function(t){},e}();t.State=e}(gtp||(gtp={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},gtp;!function(t){"use strict";var e=function(t){function e(e,i,s,n){t.call(this),this._leavingState=e,this._enteringState=i,this._transitionLogic=s,this._fadingOut=!0,this._alpha=1,this._halfTime=n&&n>0?n/2:800,this._curTime=0}return __extends(e,t),e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._curTime+=e,this._curTime>=this._halfTime){if(this._curTime-=this._halfTime,!this._fadingOut)return void this._setState(this._enteringState);this._fadingOut=!1,this._transitionLogic&&this._transitionLogic()}this._fadingOut?this._alpha=1-this._curTime/this._halfTime:this._alpha=this._curTime/this._halfTime},e.prototype.render=function(e){t.prototype.render.call(this,e),this.game.clearScreen();var i=e.globalAlpha;e.globalAlpha=this._alpha,this._fadingOut?this._leavingState.render(e):this._enteringState.render(e),e.globalAlpha=i},e.prototype._setState=function(t){this.game.setState(this._enteringState)},e}(t.State);t.FadeOutInState=e}(gtp||(gtp={}));var tiled;!function(t){"use strict";var e=function(){function t(t,e){this.firstgid=t.firstgid,this.image=t.image,e&&(this.image=e(this.image)),this.imageWidth=t.imagewidth,this.imageHeight=t.imageheight,this.margin=t.margin,this.name=t.name,this.properties=t.properties,this.spacing=t.spacing,this.tileWidth=t.tilewidth,this.tileHeight=t.tileheight}return t.prototype.setScale=function(t){this.imageWidth*=t,this.imageHeight*=t,this.tileWidth*=t,this.tileHeight*=t,this.margin*=t,this.spacing*=t},t}();t.TiledTileset=e}(tiled||(tiled={}));var tiled;!function(t){"use strict";var e=function(){function e(e,i){this.rowCount=e.height,this.colCount=e.width,this.tileWidth=i.tileWidth,this.tileHeight=i.tileHeight,this.screenWidth=i.screenWidth,this.screenHeight=i.screenHeight,this.screenRows=Math.ceil(this.screenHeight/this.tileHeight),this.screenCols=Math.ceil(this.screenWidth/this.tileWidth);var s=i?i.imagePathModifier:null;this.layers=[],this.layersByName={},this.objectGroups=[];for(var n=0;n<e.layers.length;n++)this.addLayer(e.layers[n]);if(this.tilesets=[],e.tilesets&&e.tilesets.length)for(n=0;n<e.tilesets.length;n++)this.tilesets.push(new t.TiledTileset(e.tilesets[n],s));this.properties=e.properties,this.version=e.version,this.orientation=e.orientation}return e.prototype.addLayer=function(e){var i=new t.TiledLayer(this,e);this.layers.push(i),this.layersByName[i.name]=i,i.isObjectGroup()&&this.objectGroups.push(i)},e.prototype.draw=function(t,e,i,s,n){void 0===s&&(s=0),void 0===n&&(n=0);var o=this.colCount,a=this.rowCount,r=this.screenRows,h=this.screenCols,c=this.tileWidth,u=this.tileHeight,p=c,l=this.screenWidth,d=this.screenHeight,g=i-Math.floor(r/2);
0>g&&(g+=o);var _=e-Math.floor(h/2);0>_&&(_+=a);var f=i*c+s+c/2,m=e*u+n+u/2,y=f-l/2,S=m-d/2,E=Math.floor(y/c);0>y%p&&E--;var T=E*c,v=Math.floor(S/u);0>S%p&&v--;var I=v*u,b=T-y,w=b,O=I-S,A=O;0>E&&(E+=o),0>v&&(v+=a);for(var P=v,D=this.getLayerCount(),C=0;d>A;){for(var M=0;D>M;M++){var L=E;w=b;var x=this.getLayerByIndex(M);if(x.visible){var N;for(x.opacity<1&&(N=t.globalAlpha,t.globalAlpha=N*x.opacity);l>w;){var G=x.getData(P%a,L%o);this.drawTile(t,w,A,G,x),C++,w+=c,L++}x.opacity<1&&(t.globalAlpha=N)}}A+=u,P++}},e.prototype.getLayer=function(t){return this.layersByName[t]},e.prototype.getLayerByIndex=function(t){return this.layers[t]},e.prototype.getLayerCount=function(){return this.layers.length},e.prototype._getImageForGid=function(t){for(var e=this.tilesets.length,i=0;e>i;i++)if(this.tilesets[i].firstgid>t)return this.tilesets[i-1];return this.tilesets[e-1]},e.prototype.drawTile=function(t,e,i,s,n){if(!(0>=s)){var o=this._getImageForGid(s);if(!o)return void console.log("null tileset for: "+s+" (layer "+n.name+")");if(s-=o.firstgid,!(0>s)){var a=window.game,r=a.assets.getTmxTilesetImage(o),h=this.tileWidth,c=h+o.spacing,u=this.tileHeight,p=u+o.spacing,l=Math.floor(r.width/c);o.spacing>0&&r.width%c===h&&l++;var d=Math.floor(s/l)*p,g=s%l*c;r.drawScaled2(t,g,d,h,u,e,i,h,u)}}},e.prototype.setScale=function(t){this.tileWidth*=t,this.tileHeight*=t,this.screenRows=Math.ceil(this.screenHeight/this.tileHeight),this.screenCols=Math.ceil(this.screenWidth/this.tileWidth);for(var e=this.tilesets.length,i=0;e>i;i++)return this.tilesets[i].setScale(t)},e.prototype.getPixelWidth=function(){return this.colCount*this.tileWidth},e.prototype.getPixelHeight=function(){return this.rowCount*this.tileHeight},e.prototype.removeLayer=function(t){for(var e=0;e<this.layers.length;e++){if(this.layers[e].name===t){this.layers.splice(e,1),delete this.layersByName[t];for(var i=0;i<this.objectGroups.length;i++)this.objectGroups[i].name===t&&delete this.objectGroups[i]}return!0}return!1},e}();t.TiledMap=e}(tiled||(tiled={}));var tiled;!function(t){"use strict";var e=function(){function t(t){gtp.Utils.mixin(t,this),this.properties=this.properties||{},this.gid=this.gid||-1;var e=window.game;this.x*=e._scale,this.y*=e._scale,this.width*=e._scale,this.height*=e._scale}return t.prototype.intersects=function(t,e,i,s){var n=this.width,o=this.height,a=i,r=s;if(0>=a||0>=r||0>=n||0>=o)return!1;var h=this.x,c=this.y,u=t,p=e;return a+=u,r+=p,n+=h,o+=c,(u>a||a>h)&&(p>r||r>c)&&(h>n||n>u)&&(c>o||o>p)},t}();t.TiledObject=e}(tiled||(tiled={}));var tiled;!function(t){"use strict";var e=function(){function e(t,e){this.map=t,this.name=e.name,this.width=e.width,this.height=e.height,this.data=e.data,this.opacity=e.opacity,this.visible=e.visible,this.type=e.type,this.x=e.x,this.y=e.y,this._setObjects(e.objects)}return e.prototype.getData=function(t,e){if(!this.data)return-1;var i=this._getIndex(t,e);return this.data[i]},e.prototype.setData=function(t,e,i){if(!this.data)return!1;var s=this._getIndex(t,e);this.data[s]=i},e.prototype._getIndex=function(t,e){return t*this.map.colCount+e},e.prototype.getObjectByName=function(t){return this.objectsByName?this.objectsByName[t]:null},e.prototype.getObjectIntersecting=function(t,e,i,s){if(this.objects)for(var n=0;n<this.objects.length;n++){var o=this.objects[n];if(o.intersects(t,e,i,s))return o}return null},e.prototype.isObjectGroup=function(){return"objectgroup"===this.type},e.prototype._setObjects=function(e){if(e){this.objects=[],this.objectsByName={};for(var i=0;i<e.length;i++){var s=new t.TiledObject(e[i]);this.objects.push(s),this.objectsByName[e[i].name]=s}}},e}();t.TiledLayer=e}(tiled||(tiled={}));var pacman;!function(t){"use strict";!function(t){t[t.EAST=0]="EAST",t[t.SOUTH=1]="SOUTH",t[t.WEST=2]="WEST",t[t.NORTH=3]="NORTH"}(t.Direction||(t.Direction={}));var e=(t.Direction,function(){function e(){}return e.fromString=function(e){switch(void 0===e&&(e="SOUTH"),e.toUpperCase()){case"NORTH":return t.Direction.NORTH;case"EAST":return t.Direction.EAST;case"WEST":return t.Direction.WEST;case"SOUTH":default:return t.Direction.SOUTH}},e}());t.DirectionUtil=e}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e=5e4;!function(t){t[t.UPDATE_ALL=0]="UPDATE_ALL",t[t.UPDATE_NONE=1]="UPDATE_NONE",t[t.UPDATE_ONE=2]="UPDATE_ONE"}(t.GhostUpdateStrategy||(t.GhostUpdateStrategy={}));var i=t.GhostUpdateStrategy,s=function(s){function n(n){s.call(this,n),this._highScore=e,this.pacman=new t.Pacman,this._ghosts=this._createGhostArray(),this._chompSound=0,this._ghostUpdateStrategy=i.UPDATE_ALL,this._score=0,this._extraPointsArray=[100,200,300,400,500,700,800,1e3,1600,2e3,3e3,5e3]}return __extends(n,s),n.prototype.addFruit=function(){this._fruit||(this._fruit=new t.Fruit,this._fruitScoreIndex=-1,this._fruitScoreEndTime=-1)},n.prototype.checkForCollisions=function(){for(var e=0;e<this._ghosts.length;e++)if(this.pacman.intersects(this._ghosts[e]))return this._ghosts[e];return this._fruit&&-1===this._fruitScoreIndex&&this.pacman.intersects(this._fruit)&&(this.increaseScore(this._extraPointsArray[this._fruit.pointsIndex]),this.audio.playSound(t.Sounds.EATING_FRUIT,!1),this._fruitScoreIndex=this._fruit.pointsIndex,this._fruitScoreEndTime=game.playTime+n.SCORE_DISPLAY_LENGTH),null},n.prototype.checkLoopedSound=function(){if(!this._resettingGhostStates){for(var e=!1,i=0;i<this._ghosts.length;i++){if(this._ghosts[i].isEyes())return void this.setLoopedSound(t.Sounds.EYES_RUNNING);this._ghosts[i].isBlue()&&(e=!0)}this.setLoopedSound(e?t.Sounds.CHASING_GHOSTS:t.Sounds.SIREN)}},n.prototype._createGhostArray=function(){var e=[];return this._resettingGhostStates=!0,e.push(new t.Blinky(this)),e.push(new t.Pinky(this)),e.push(new t.Inky(this)),e.push(new t.Clyde(this)),this._resettingGhostStates=!1,e},n.prototype.drawBigDot=function(t,e){var i=this.playTime;if(0>i||i%500>250){var s=this.canvas.getContext("2d"),n=135,o=38;game.assets.get("sprites").drawScaled2(s,n,o,8,8,t,e,8,8)}},n.prototype.drawFruit=function(t){if(this._fruitScoreIndex>-1){this.paintPointsEarned(t,this._fruitScoreIndex,this._fruit.x,this._fruit.y);var e=game.playTime;e>=this._fruitScoreEndTime&&(this._fruit=null,this._fruitScoreIndex=-1,this._fruitScoreEndTime=-1)}else this._fruit&&this._fruit.paint(t)},n.prototype.drawGhosts=function(t){this._ghosts.forEach(function(e){e.paint(t)})},n.prototype.drawScores=function(t){var e=this._score.toString(),i=55-8*e.length,s=10;this.drawString(i,s,e,t),e=this._highScore.toString(),i=132-8*e.length,this.drawString(i,s,e,t)},n.prototype.drawScoresHeaders=function(t){this.drawString(16,0,"1UP",t),this.drawString(67,0,"HIGH SCORE",t)},n.prototype.drawSmallDot=function(t,e){var i=this.canvas.getContext("2d");i.fillRect(t,e,2,2)},n.prototype.drawSprite=function(t,e,i,s){var n=game.assets.get("sprites"),o=this.canvas.getContext("2d");n.drawScaled2(o,i,s,16,16,t,e,16,16)},n.prototype.drawString=function(t,e,i,s){void 0===s&&(s=game.canvas.getContext("2d"));for(var n,o=i.toString(),a=this.assets.get("font"),r="A".charCodeAt(0),h="0".charCodeAt(0),c=0;c<o.length;c++){var u=o[c],p=o.charCodeAt(c);if(u>="A"&&"Z">=u)n=a.colCount+(p-r);else if(u>="0"&&"9">=u)n=p-h;else switch(u){case"-":n=10;break;case".":n=11;break;case">":n=12;break;case"@":n=13;break;case"!":n=14;break;default:n=15}a.drawByIndex(s,t,e,n),t+=9}},n.prototype.getGhost=function(t){return this._ghosts[t]},Object.defineProperty(n.prototype,"godMode",{get:function(){return this._godMode},enumerable:!0,configurable:!0}),Object.defineProperty(n,"EXTRA_LIFE_SCORE",{get:function(){return 1e4},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"level",{get:function(){return this._level},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lives",{get:function(){return this._lives},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PENALTY_BOX_EXIT_X",{get:function(){return(this.getWidth()-n.SPRITE_SIZE)/2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PENALTY_BOX_EXIT_Y",{get:function(){return 12*n.TILE_SIZE-n.TILE_SIZE/2},enumerable:!0,configurable:!0}),Object.defineProperty(n,"SCORE_DISPLAY_LENGTH",{get:function(){return 750},enumerable:!0,configurable:!0}),Object.defineProperty(n,"SPRITE_SIZE",{get:function(){return 16},enumerable:!0,configurable:!0}),Object.defineProperty(n,"TILE_SIZE",{get:function(){return 8},enumerable:!0,configurable:!0}),n.prototype.ghostEaten=function(e){switch(this._eatenGhostPointsIndex){case 0:this._eatenGhostPointsIndex=1;break;case 1:this._eatenGhostPointsIndex=3;break;case 3:this._eatenGhostPointsIndex=6;break;default:case 6:this._eatenGhostPointsIndex=8}return this.increaseScore(this._extraPointsArray[this._eatenGhostPointsIndex]),this.audio.playSound(t.Sounds.EATING_GHOST),this._eatenGhostPointsIndex},n.prototype.increaseLives=function(t){return this._lives+=t},n.prototype.increaseScore=function(e){this._score+=e,this._score>this._highScore&&(this._highScore=this._score),!this._earnedExtraLife&&this._score>=n.EXTRA_LIFE_SCORE&&(this.audio.playSound(t.Sounds.EXTRA_LIFE),this.increaseLives(1),this._earnedExtraLife=!0)},n.prototype.loadNextLevel=function(){this.setLoopedSound(null),this._level++,this._fruit=null,this._fruitScoreIndex=-1,this._fruitScoreEndTime=-1;var t=this.state;t.reset()},n.prototype.makeGhostsBlue=function(){this._eatenGhostPointsIndex=0,this._ghosts.forEach(function(t){t.possiblyTurnBlue()}),this.checkLoopedSound()},n.prototype.paintPointsEarned=function(t,e,i,s){var n=game.assets.get("points");n.drawByIndex(t,i,s,e)},n.prototype.playChompSound=function(){this.audio.playSound(0===this._chompSound?t.Sounds.CHOMP_1:t.Sounds.CHOMP_2),this._chompSound=(this._chompSound+1)%2},n.prototype.resetGhosts=function(){this._resettingGhostStates=!0;for(var e=[new gtp.Point(2,1),new gtp.Point(2,t.Maze.TILE_COUNT_HORIZONTAL-2),new gtp.Point(t.Maze.TILE_COUNT_VERTICAL-2,1),new gtp.Point(t.Maze.TILE_COUNT_VERTICAL-2,t.Maze.TILE_COUNT_HORIZONTAL-2)],i=gtp.Utils.randomInt(4),s=0;s<this._ghosts.length;s++)this._ghosts[s].reset(),this._ghosts[s].setCorner(e[(i+s)%4]);this._resettingGhostStates=!1},n.prototype.setLoopedSound=function(t){t!==this._loopedSoundName&&(null!=this._loopedSoundId&&this.audio.stopSound(this._loopedSoundId),this._loopedSoundName=t,null!=t?this._loopedSoundId=game.audio.playSound(t,!0):this._loopedSoundId=null)},Object.defineProperty(n.prototype,"ghostUpdateStrategy",{set:function(t){this._ghostUpdateStrategy=t},enumerable:!0,configurable:!0}),n.prototype.toggleGodMode=function(){return this._godMode=!this._godMode,this.setStatusMessage("God mode "+(this._godMode?"enabled":"disabled")),this._godMode},n.prototype.startGame=function(e){this._lives=3,this._score=0,this._level=0;var i=game.assets.get("levels")[e],s=new t.MazeState(i);this.setState(s)},n.prototype.startPacmanDying=function(){this.setLoopedSound(null),this.audio.playSound(t.Sounds.DIES),this.pacman.startDying()},n.prototype.updateSpriteFrames=function(){this.pacman.updateFrame(),this._ghosts.forEach(function(t){t.updateFrame()})},n.prototype.updateSpritePositions=function(t,e){switch(this._ghostUpdateStrategy){case i.UPDATE_ALL:this._ghosts.forEach(function(i){i.updatePosition(t,e)});break;case i.UPDATE_NONE:break;case i.UPDATE_ONE:this._ghosts[0].updatePosition(t,e)}this.pacman.updatePosition(t,e)},n}(gtp.Game);t.PacmanGame=s}(pacman||(pacman={}));var pacman;!function(t){"use strict";var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.row=t,this.col=e}return t.prototype.equals=function(t){return this.row===t.row&&this.col===t.col},t.prototype.set=function(t,e,i){this.row=t,this.col=e,this.parent=i},t.prototype.toString=function(){return"[MazeNode: ("+this.row+","+this.col+")]"},t}();t.MazeNode=e}(pacman||(pacman={}));var pacman;!function(t){"use strict";var e=[50,10],i=function(){function i(e){this.closed=[],this.open=[],this.goalNode=new t.MazeNode,this._data=[],this.reset(e)}return i._cloneObjectOfPrimitives=function(t){return JSON.parse(JSON.stringify(t))},i.prototype.checkForDot=function(t,s){var n=0,o=this._getTileAt(t,s);return o>=254&&(game.playChompSound(),254===o&&game.makeGhostsBlue(),this._eatenDotCount++,this._data[t][s]=0,n=e[o-254],this._eatenDotCount===i.FRUIT_DOT_COUNT&&game.addFruit(),this._eatenDotCount===this._dotCount&&game.loadNextLevel()),n},i._constructPath=function(t){for(var e=null;t.parent;)e=t,t=t.parent;return e},Object.defineProperty(i,"FRUIT_DOT_COUNT",{get:function(){return 64},enumerable:!0,configurable:!0}),i._getNextColumn=function(t){return++t===i.TILE_COUNT_HORIZONTAL&&(t=0),t},i.prototype.getPathBreadthFirst=function(e,s,n,o){var a=this;this.open.forEach(function(t){a._data[t.row][t.col]&=255}),this.closed.forEach(function(t){a._data[t.row][t.col]&=255}),this.open.length=0,this.closed.length=0,this.goalNode.set(n,o,null);var r=this._nodeCache.borrowObj();for(this.open.push(new t.MazeNode(e,s)),this._data[e][s]|=256;this.open.length>0;){var h=this.open.splice(0,1)[0];if(h.equals(this.goalNode))return this._data[h.row][h.col]&=255,i._constructPath(h);this.closed.push(h),this.isWalkable(h.row-1,h.col)&&0===(256&this._data[h.row-1][h.col])&&(this._data[h.row-1][h.col]|=256,r.set(h.row-1,h.col,h),this.open.push(r),r=this._nodeCache.borrowObj()),this.isWalkable(h.row+1,h.col)&&0===(256&this._data[h.row+1][h.col])&&(this._data[h.row+1][h.col]|=256,r.set(h.row+1,h.col,h),this.open.push(r),r=this._nodeCache.borrowObj());var c=i._getPreviousColumn(h.col);this.isWalkable(h.row,c)&&0===(256&this._data[h.row][c])&&(this._data[h.row][c]|=256,r.set(h.row,c,h),this.open.push(r),r=this._nodeCache.borrowObj()),c=i._getNextColumn(h.col),this.isWalkable(h.row,c)&&0===(256&this._data[h.row][c])&&(this._data[h.row][c]|=256,r.set(h.row,c,h),this.open.push(r),r=this._nodeCache.borrowObj())}throw new Error("No path found from ("+e+", "+s+") to ("+n+", "+o+")")},i._getPreviousColumn=function(t){return 0===t&&(t=i.TILE_COUNT_HORIZONTAL),t-1},Object.defineProperty(i,"TILE_COUNT_HORIZONTAL",{get:function(){return 28},enumerable:!0,configurable:!0}),Object.defineProperty(i,"TILE_COUNT_VERTICAL",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(i,"TILE_DOT_BIG",{get:function(){return 254},enumerable:!0,configurable:!0}),Object.defineProperty(i,"TILE_DOT_SMALL",{get:function(){return 255},enumerable:!0,configurable:!0}),i.prototype._getTileAt=function(t,e){return 0>e||e>=i.TILE_COUNT_HORIZONTAL?-1:0>t||t>=i.TILE_COUNT_VERTICAL?-1:255&this._data[t][e]},i.prototype.isClearShotColumn=function(t,e,i){for(var s=Math.min(e,i),n=Math.max(e,i),o=s+1;n>o;o++)if(!this.isWalkable(o,t))return!1;return!0},i.prototype.isClearShotRow=function(t,e,i){for(var s=Math.min(e,i),n=Math.max(e,i),o=s+1;n>o;o++)if(!this.isWalkable(t,o))return!1;return!0},i.prototype.isWalkable=function(t,e){var i=this._getTileAt(t,e);return 0===i||i>=240},i.prototype.render=function(t){t.drawImage(this._mazeCanvas,0,0);var e=8;t.fillStyle="#ffffff";for(var s=0;s<i.TILE_COUNT_VERTICAL;s++)for(var n=s*e+2*e,o=0;o<i.TILE_COUNT_HORIZONTAL;o++){var a=this._getTileAt(s,o),r=o*e;a===i.TILE_DOT_SMALL?game.drawSmallDot(r+3,n+2):a===i.TILE_DOT_BIG&&game.drawBigDot(r,n)}},i.prototype.reset=function(e){var s=t.PacmanGame.TILE_SIZE,n=null!=e;if(n&&(this._origMazeInfo=i._cloneObjectOfPrimitives(e)),this._data=i._cloneObjectOfPrimitives(this._origMazeInfo),n){var o=game.assets.get("mapTiles"),a=2*s;this._mazeCanvas=gtp.ImageUtils.createCanvas(game.getWidth(),game.getHeight());var r=this._mazeCanvas.getContext("2d"),h=0;this._eatenDotCount=0,this._dotCount=0,r.fillStyle="#000000",r.fillRect(0,0,this._mazeCanvas.width,this._mazeCanvas.height),game.drawScoresHeaders(r);for(var c=0;c<this._data.length;c++)for(var u=this._data[c],p=0;p<u.length;p++){var l=u[p];switch((0===l||l>=240)&&h++,l){case i.TILE_DOT_SMALL:case i.TILE_DOT_BIG:this._dotCount++;break;default:if(l--,l>-1){var d=p*s,g=a+c*s;o.drawByIndex(r,d,g,l)}}}this._nodeCache||(this._nodeCache=new gtp.Pool(t.MazeNode,h))}},i}();t.Maze=i}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e=function(t){function e(e){t.call(this,e),this._lastConfigKeypressTime=gtp.Utils.timestamp()}return __extends(e,t),Object.defineProperty(e,"INPUT_REPEAT_MILLIS",{get:function(){return 200},enumerable:!0,configurable:!0}),e.prototype.handleDefaultKeys=function(){var t=gtp.Utils.timestamp(),i=this.game.inputManager;t>this._lastConfigKeypressTime+e.INPUT_REPEAT_MILLIS&&(i.isKeyDown(gtp.Keys.KEY_M,!0)&&(game.toggleMuted(),this._lastConfigKeypressTime=t),i.isKeyDown(gtp.Keys.KEY_Z)&&(i.isKeyDown(gtp.Keys.KEY_P,!0)?(game.canvas.style.width||(game.canvas.style.width=game.canvas.width+"px"),game.canvas.style.height||(game.canvas.style.height=game.canvas.height+"px"),game.canvas.style.width=parseInt(game.canvas.style.width.substring(0,game.canvas.style.width.length-2),10)+1+"px",game.canvas.style.height=parseInt(game.canvas.style.height.substring(0,game.canvas.style.height.length-2),10)+1+"px",game.setStatusMessage("Canvas size now: ("+game.canvas.style.width+", "+game.canvas.style.height+")"),this._lastConfigKeypressTime=t):i.isKeyDown(gtp.Keys.KEY_L,!0)?(game.canvas.style.width||(game.canvas.style.width=game.canvas.width+"px"),game.canvas.style.height||(game.canvas.style.height=game.canvas.height+"px"),game.canvas.style.width=parseInt(game.canvas.style.width.substring(0,game.canvas.style.width.length-2),10)-1+"px",game.canvas.style.height=parseInt(game.canvas.style.height.substring(0,game.canvas.style.height.length-2),10)-1+"px",game.setStatusMessage("Canvas size now: ("+game.canvas.style.width+", "+game.canvas.style.height+")"),this._lastConfigKeypressTime=t):i.isKeyDown(gtp.Keys.KEY_G,!0)&&(game.toggleGodMode(),this._lastConfigKeypressTime=t)))},e}(gtp.State);t._BaseState=e}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e=function(e){function i(t){e.call(this,t),this._initSprites()}return __extends(i,e),i.prototype.enter=function(){e.prototype.enter.call(this,game),game.canvas.addEventListener("touchstart",this.handleStart,!1),this._choice=0,this._lastKeypressTime=game.playTime,this._initSprites()},i.prototype._initSprites=function(){var e=game.pacman;e.setLocation(game.getWidth()/2,240),e.direction=t.Direction.EAST;var i=game.getGhost(0);i.setLocation(game.getWidth()/2-3*t.PacmanGame.SPRITE_SIZE,240),i.direction=t.Direction.EAST},i.prototype.leaving=function(t){t.canvas.removeEventListener("touchstart",this.handleStart,!1)},i.prototype.getGame=function(){return this.game},i.prototype.handleStart=function(){console.log("Yee, touch detected!"),this._startGame()},i.prototype.render=function(t){var e=game.getWidth(),i=game.getHeight(),s=9;this._renderStaticStuff(t);var n=(e-15*s)/2-5,o=(i-30)/2;this.getGame().drawString(n,o+15*this._choice,">"),n+=1.5*s,o=200,game.canvas.getContext("2d").fillStyle="#ffffff",game.drawSmallDot(n+3,o+2),o+=9,game.drawBigDot(n,o),game.pacman.render(t),game.getGhost(0).paint(t),game.audio.isInitialized()||this._renderNoSoundMessage()},i.prototype._stringWidth=function(t){return game.assets.get("font").cellW*t.length},i.prototype._renderNoSoundMessage=function(){var t=game.getWidth(),e="SOUND IS DISABLED AS",i=(t-this._stringWidth(e))/2,s=game.getHeight()-20-27;this.getGame().drawString(i,s,e),e="YOUR BROWSER DOES NOT",i=(t-this._stringWidth(e))/2,s+=9,this.getGame().drawString(i,s,e),e="SUPPORT WEB AUDIO",i=(t-this._stringWidth(e))/2,s+=9,this.getGame().drawString(i,s,e)},i.prototype._renderStaticStuff=function(t){var e=this.game;e.clearScreen("rgb(0,0,0)");var i=e.getWidth(),s=9;e.drawScores(t),e.drawScoresHeaders(t);var n=e.assets.get("title"),o=(i-n.width)/2,a=1.2*n.height;n.draw(t,o,a);var r="STANDARD MAZE",h=r.length-1;o=(i-s*h)/2-5,a=(e.getHeight()-30)/2,this.getGame().drawString(o,a,r,t),r="ALTERNATE MAZE",a+=15,this.getGame().drawString(o,a,r,t),o+=2*s,r="10 POINTS",h=r.length-2,a=200,this.getGame().drawString(o,a,r,t),r="50 POINTS",a+=9,this.getGame().drawString(o,a,r,t),r="2015 OLD MAN GAMES",o=(i-s*r.length)/2,a=e.getHeight()-20,this.getGame().drawString(o,a,r,t)},i.prototype._startGame=function(){game.startGame(this._choice)},i.prototype.update=function(e){this.handleDefaultKeys();var i=game.playTime;if(i>this._lastKeypressTime+t._BaseState.INPUT_REPEAT_MILLIS+100){var s=game.inputManager;s.up()?(this._choice=Math.abs(this._choice-1),game.audio.playSound(t.Sounds.TOKEN),this._lastKeypressTime=i):s.down()?(this._choice=(this._choice+1)%2,game.audio.playSound(t.Sounds.TOKEN),this._lastKeypressTime=i):s.enter(!0)&&this._startGame()}var n=game.pacman,o=game.getGhost(0),a=n.moveAmount;n.direction===t.Direction.WEST&&(a=-a),n.incX(a),a=o.moveAmount,o.direction===t.Direction.WEST&&(a=-a),o.incX(a),n.x+n.width>=this.game.getWidth()-30?n.direction=o.direction=t.Direction.WEST:o.x<=30&&(n.direction=o.direction=t.Direction.EAST),n.updateFrame(),o.updateFrame()},i}(t._BaseState);t.TitleState=e}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.prototype.update=function(e){if(this.handleDefaultKeys(),!this.assetsLoaded){this.assetsLoaded=!0;var i=this.game,s=this;i.assets.addImage("loading","res/loadingMessage.png"),i.assets.onLoad(function(){s._loadingImage=i.assets.get("loading"),i.assets.addImage("title","res/title.png"),i.assets.addSpriteSheet("font","res/font.png",9,7,0,0),i.assets.addImage("sprites","res/sprite_tiles.png",!0),i.assets.addSpriteSheet("mapTiles","res/map_tiles.png",8,8,0,0),i.assets.addSpriteSheet("points","res/points.png",18,9,0,0),i.assets.addJson("levels","res/levelData.json"),i.assets.addSound(t.Sounds.CHASING_GHOSTS,"res/sounds/chasing_ghosts.wav"),i.assets.addSound(t.Sounds.CHOMP_1,"res/sounds/chomp_1.wav"),i.assets.addSound(t.Sounds.CHOMP_2,"res/sounds/chomp_2.wav"),i.assets.addSound(t.Sounds.DIES,"res/sounds/dies.wav"),i.assets.addSound(t.Sounds.EATING_FRUIT,"res/sounds/eating_fruit.wav"),i.assets.addSound(t.Sounds.EATING_GHOST,"res/sounds/eating_ghost.wav"),i.assets.addSound(t.Sounds.EXTRA_LIFE,"res/sounds/extra_life.wav"),i.assets.addSound(t.Sounds.EYES_RUNNING,"res/sounds/eyes_running.wav"),i.assets.addSound(t.Sounds.INTERMISSION,"res/sounds/intermission.wav"),i.assets.addSound(t.Sounds.OPENING,"res/sounds/opening.wav"),i.assets.addSound(t.Sounds.SIREN,"res/sounds/siren.wav"),i.assets.addSound(t.Sounds.TOKEN,"res/sounds/token.wav"),i.assets.onLoad(function(){function e(t){return parseInt(t,16)}for(var n=i.assets.get("levels"),o=0;o<n.length;o++)for(var a=0;a<n[o].length;a++)n[o][a]=n[o][a].map(e);var r=gtp.Utils.getRequestParam("skipTitle");null!==r?this.getGame().startNewGame():i.setState(new gtp.FadeOutInState(s,new t.TitleState))})})}},i}(t._BaseState);t.LoadingState=e}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e;!function(t){t[t.READY=0]="READY",t[t.IN_GAME=1]="IN_GAME",t[t.DYING=2]="DYING",t[t.GAME_OVER=3]="GAME_OVER"}(e||(e={}));var i=function(i){function s(t){i.call(this),this._mazeFile=t}return __extends(s,i),Object.defineProperty(s,"DYING_FRAME_DELAY_MILLIS",{get:function(){return 75},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_readyDelayMillis",{get:function(){return this._firstTimeThrough?4500:2e3},enumerable:!0,configurable:!0}),s.prototype.enter=function(){game.pacman.reset(),game.resetGhosts(),this._maze=new t.Maze(this._mazeFile),this._firstTimeThrough=!0,this._updateScoreIndex=-1,this._lastMazeScreenKeypressTime=game.playTime+s.INPUT_REPEAT_MILLIS,this._substate=e.READY,this._firstTimeThrough=!0,this._substateStartTime=0,this._nextDyingFrameTime=0,this._nextUpdateTime=0,this._lastSpriteFrameTime=0},s.prototype._paintExtraLives=function(t){var e=24,i=8,s=game.lives;if(s>0)for(var n=e,o=game.getHeight()-2*i,a=2*i,r=0;s>r;r++)game.drawSprite(n,o,192,48),n+=a},s.prototype._paintPossibleFruits=function(e){var i=12,s=t.PacmanGame.TILE_SIZE,n=game.getWidth()-i-2*s,o=game.getHeight()-2*s;switch(game.level){default:case 7:game.drawSprite(n-112,o,208,48);case 6:game.drawSprite(n-96,o,208,96);case 5:game.drawSprite(n-80,o,192,96);case 4:game.drawSprite(n-64,o,208,32);case 3:game.drawSprite(n-48,o,208,80);case 2:game.drawSprite(n-32,o,192,80);case 1:game.drawSprite(n-16,o,208,64);case 0:game.drawSprite(n,o,192,64)}},s.prototype.render=function(s){i.prototype.render.call(this,s),this._maze.render(s);var n=8,o=game.getHeight()-2*n-t.Maze.TILE_COUNT_VERTICAL*n;s.translate(0,o),game.drawFruit(s);var a=game.pacman;if(-1===this._updateScoreIndex)this._substate!==e.GAME_OVER&&a.render(s);else{var r=a.bounds.x,h=a.bounds.y;game.paintPointsEarned(s,this._updateScoreIndex,r,h)}if(game.drawGhosts(s),s.translate(0,-o),game.drawScores(s),this._paintExtraLives(s),this._paintPossibleFruits(s),this._substate===e.READY){var c="READY!",r=(game.getWidth()-9*c.length)/2;r+=3,game.drawString(r,160,c)}else if(this._substate===e.GAME_OVER){var u="GAME OVER",r=(game.getWidth()-9*u.length)/2;game.drawString(r,160,u)}if(game.paused){s.globalAlpha=.4,s.fillStyle="black",s.fillRect(0,0,game.getWidth(),game.getHeight()),s.globalAlpha=1,s.fillRect(50,100,game.getWidth()-100,game.getHeight()-200);var p="PAUSED",r=(game.getWidth()-9*p.length)/2;game.drawString(r,(game.getHeight()-18)/2,p)}},s.prototype.reset=function(){this._maze.reset(),game.resetPlayTime(),game.pacman.reset(),game.resetGhosts(),this._substate=e.READY,this._substateStartTime=0,this._lastSpriteFrameTime=0,this._lastMazeScreenKeypressTime=game.playTime+s.INPUT_REPEAT_MILLIS},s.prototype._handleInput=function(t,i){this.handleDefaultKeys();var n=game.inputManager;if(this._substate!==e.GAME_OVER&&n.enter(!0))return game.paused=!game.paused,void(this._lastMazeScreenKeypressTime=i);if(!game.paused)switch(this._substate){case e.IN_GAME:game.pacman.handleInput(this._maze);break;case e.GAME_OVER:n.enter(!0)&&game.setState(new pacman.TitleState(game))}i>=this._lastMazeScreenKeypressTime+s.INPUT_REPEAT_MILLIS&&!game.paused&&this._substate===e.IN_GAME&&n.isKeyDown(gtp.Keys.KEY_Z)&&(n.isKeyDown(gtp.Keys.KEY_X)?(game.loadNextLevel(),this._lastMazeScreenKeypressTime=i):n.isKeyDown(gtp.Keys.KEY_C)&&this._substate!==e.DYING&&(game.startPacmanDying(),this._substate=e.DYING,this._nextDyingFrameTime=i+s.DYING_FRAME_DELAY_MILLIS,this._lastMazeScreenKeypressTime=i))},s.prototype.update=function(t){i.prototype.update.call(this,t),this._handleInput(t,game.playTime);var n=game.playTime;switch(this._substate){case e.READY:this._firstTimeThrough&&0===this._substateStartTime&&(this._substateStartTime=n,game.audio.playSound(pacman.Sounds.OPENING)),n>=this._substateStartTime+this._readyDelayMillis&&(this._substate=e.IN_GAME,this._substateStartTime=n,game.resetPlayTime(),this._lastMazeScreenKeypressTime=game.playTime,game.setLoopedSound(pacman.Sounds.SIREN),this._firstTimeThrough=!1);break;case e.IN_GAME:this._updateInGameImpl(n);break;case e.DYING:n>=this._nextDyingFrameTime&&(game.pacman.incDying()?this._nextDyingFrameTime=n+s.DYING_FRAME_DELAY_MILLIS:game.increaseLives(-1)<=0?this._substate=e.GAME_OVER:(game.resetPlayTime(),this._lastMazeScreenKeypressTime=game.playTime,game.pacman.reset(),game.resetGhosts(),this._substate=e.READY,this._substateStartTime=0,this._lastSpriteFrameTime=0));break;case e.GAME_OVER:}},s.prototype._updateInGameImpl=function(i){if(!(this._nextUpdateTime>0&&i<this._nextUpdateTime)){this._nextUpdateTime=0,this._updateScoreIndex=-1,i>=this._lastSpriteFrameTime+100&&(this._lastSpriteFrameTime=i,game.updateSpriteFrames()),game.updateSpritePositions(this._maze,i);var n=game.checkForCollisions();if(n)switch(n.motionState){case t.MotionState.BLUE:this._nextUpdateTime=i+t.PacmanGame.SCORE_DISPLAY_LENGTH,n.motionState=t.MotionState.EYES,this._updateScoreIndex=game.ghostEaten(n);break;case t.MotionState.EYES:case t.MotionState.EYES_ENTERING_BOX:break;default:game.godMode||(game.startPacmanDying(),this._substate=e.DYING,this._nextDyingFrameTime=game.playTime+s.DYING_FRAME_DELAY_MILLIS)}}},s}(t._BaseState);t.MazeState=i}(pacman||(pacman={}));var pacman;!function(t){"use strict";var e=function(){function t(){}return t.CHASING_GHOSTS="chasingGhosts",t.CHOMP_1="chomp1",t.CHOMP_2="chomp2",t.DIES="dies",t.EATING_FRUIT="eatingFruit",t.EATING_GHOST="eatingGhost",t.EXTRA_LIFE="extraLife",t.INTERMISSION="intermission",t.EYES_RUNNING="eyesRunning",t.OPENING="opening",t.SIREN="siren",t.TOKEN="token",t}();t.Sounds=e}(pacman||(pacman={}));var pacman;!function(t){"use strict";var e=function(){function e(e){this.bounds=new gtp.Rectangle(0,0,t.PacmanGame.SPRITE_SIZE,t.PacmanGame.SPRITE_SIZE),this._intersectBounds=new gtp.Rectangle,this.direction=t.Direction.EAST,this._frame=0,this._frameCount=e,this._lastUpdateTime=0}return e.prototype.atIntersection=function(e){switch(this.direction){case t.Direction.NORTH:case t.Direction.SOUTH:return this.getCanMoveLeft(e)||this.getCanMoveRight(e);case t.Direction.EAST:case t.Direction.WEST:return this.getCanMoveUp(e)||this.getCanMoveDown(e)}return!1},e.prototype.getCanMoveDown=function(e){var i=this.centerX,s=this.centerY,n=i%this.TILE_SIZE,o=s%this.TILE_SIZE;if(0===n&&0===o){var a=this.row,r=this.column;return 30>a&&e.isWalkable(a+1,r)}return this.direction===t.Direction.NORTH||this.direction===t.Direction.SOUTH},e.prototype.getCanMoveLeft=function(e){var i=this.bounds.x;if(0>i)return!0;i+=this.TILE_SIZE/2;var s=this.centerY,n=i%this.TILE_SIZE,o=s%this.TILE_SIZE;if(0===n&&0===o){var a=this.row,r=this.column;return r>0&&e.isWalkable(a,r-1)}return this.direction===t.Direction.EAST||this.direction===t.Direction.WEST},e.prototype.getCanMoveRight=function(e){var i=this.bounds.x;if(i+this.width>this.SCREEN_WIDTH)return!0;i+=this.TILE_SIZE/2;var s=this.centerY,n=i%this.TILE_SIZE,o=s%this.TILE_SIZE;if(0===n&&0===o){var a=this.row,r=this.column;return 27>r&&e.isWalkable(a,r+1)}return this.direction===t.Direction.EAST||this.direction===t.Direction.WEST},e.prototype.getCanMoveUp=function(e){var i=this.centerX,s=this.centerY,n=i%this.TILE_SIZE,o=s%this.TILE_SIZE;if(0===n&&0===o){var a=this.row,r=this.column;return a>0&&e.isWalkable(a-1,r)}return this.direction==t.Direction.NORTH||this.direction==t.Direction.SOUTH},Object.defineProperty(e.prototype,"centerX",{get:function(){return this.bounds.x+this.TILE_SIZE/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerY",{get:function(){return this.bounds.y+this.TILE_SIZE/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"column",{get:function(){var e=Math.floor(this.centerX/this.TILE_SIZE);return 0>e?e+=t.Maze.TILE_COUNT_HORIZONTAL:e>=t.Maze.TILE_COUNT_HORIZONTAL&&(e-=t.Maze.TILE_COUNT_HORIZONTAL),e},enumerable:!0,configurable:!0}),e.prototype.getFrame=function(){return this._frame},e.prototype.getFrameCount=function(){return this._frameCount},Object.defineProperty(e.prototype,"intersectBounds",{get:function(){return this._intersectBounds.set(this.bounds.x+2,this.bounds.y-2,this.bounds.w-4,this.bounds.h-4),this._intersectBounds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"moveAmount",{get:function(){return 1},enumerable:!0,configurable:!0}),
Object.defineProperty(e.prototype,"TILE_SIZE",{get:function(){return 8},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.bounds.w},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"row",{get:function(){return Math.floor(this.centerY/this.TILE_SIZE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.bounds.x},set:function(t){this.bounds.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.bounds.y},set:function(t){this.bounds.y=t},enumerable:!0,configurable:!0}),e.prototype.goDownIfPossible=function(e,i){return this.getCanMoveDown(e)?(this.direction=t.Direction.SOUTH,this.incY(i),!0):!1},e.prototype.goLeftIfPossible=function(e,i){return this.getCanMoveLeft(e)?(this.direction=t.Direction.WEST,this.incX(-i),!0):!1},e.prototype.goRightIfPossible=function(e,i){return this.getCanMoveRight(e)?(this.direction=t.Direction.EAST,this.incX(i),!0):!1},e.prototype.goUpIfPossible=function(e,i){return this.getCanMoveUp(e)?(this.direction=t.Direction.NORTH,this.incY(-i),!0):!1},e.prototype.incX=function(t){this.bounds.x+=t,this.bounds.x+this.width<=0?this.bounds.x+=this.SCREEN_WIDTH:this.bounds.x>=this.SCREEN_WIDTH&&(this.bounds.x-=this.SCREEN_WIDTH)},e.prototype.incY=function(t){this.bounds.y+=t},e.prototype.intersects=function(t){return this.intersectBounds.intersects(t.intersectBounds)},e.prototype.reset=function(){this._lastUpdateTime=0},Object.defineProperty(e.prototype,"SCREEN_WIDTH",{get:function(){return 224},enumerable:!0,configurable:!0}),e.prototype.setLocation=function(t,e){this.bounds.x=t,this.bounds.y=e},e.prototype.updateFrame=function(){this._frame=(this._frame+1)%this.getFrameCount()},e.prototype.updatePosition=function(t,e){e>this._lastUpdateTime+this.getUpdateDelayMillis()&&(this._lastUpdateTime=e,this.updatePositionImpl(t))},e}();t._BaseSprite=e}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e=function(e){function i(){e.call(this,3),this._dyingFrame=0}return __extends(i,e),i.prototype.getUpdateDelayMillis=function(){return 10},i.prototype.handleInput=function(e){var i=game.inputManager;i.left()?this.getCanMoveLeft(e)&&(this.direction=t.Direction.WEST):i.right()&&this.getCanMoveRight(e)&&(this.direction=t.Direction.EAST),i.up()?this.getCanMoveUp(e)&&(this.direction=t.Direction.NORTH):i.down()&&this.getCanMoveDown(e)&&(this.direction=t.Direction.SOUTH)},i.prototype.incDying=function(){return this._dyingFrame=(this._dyingFrame+1)%12,0!==this._dyingFrame},i.prototype.render=function(e){var i,s,n=t.PacmanGame.SPRITE_SIZE,o=this.bounds.x,a=this.bounds.y;this._dyingFrame>0?(i=n*this._dyingFrame,s=96):(i=this.direction*n*this.getFrameCount()+this.getFrame()*n,s=80),game.drawSprite(o,a,i,s)},i.prototype.reset=function(){var i=8;e.prototype.reset.call(this),this.direction=t.Direction.WEST,this.setLocation(13*i,24*i-i/2),this._frame=0},i.prototype.setLocation=function(t,i){e.prototype.setLocation.call(this,t,i)},i.prototype.startDying=function(){this._dyingFrame=1},i.prototype.updatePositionImpl=function(e){var i=this.moveAmount;switch(this.direction){case t.Direction.WEST:this.goLeftIfPossible(e,i);break;case t.Direction.EAST:this.goRightIfPossible(e,i);break;case t.Direction.NORTH:this.goUpIfPossible(e,i);break;case t.Direction.SOUTH:this.goDownIfPossible(e,i)}game.increaseScore(e.checkForDot(this.row,this.column))},i}(t._BaseSprite);t.Pacman=e}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e=function(e){function i(){e.call(this,1),this.setLocation(game.PENALTY_BOX_EXIT_X,140);var t=game.level;t>7&&(t=game.randomInt(8)),this._col=i.COLS[t],this._row=i.ROWS[t],this._pointsIndex=i.PTS_INDEX[t]}return __extends(i,e),Object.defineProperty(i.prototype,"pointsIndex",{get:function(){return this._pointsIndex},enumerable:!0,configurable:!0}),i.prototype.getUpdateDelayMillis=function(){return 1e11},i.prototype.paint=function(e){var i=t.PacmanGame.SPRITE_SIZE,s=this._col*i,n=this._row*i;game.drawSprite(this.x,this.y,s,n)},i.prototype.updatePositionImpl=function(t){},i.COLS=[12,13,12,13,13,12,13,13],i.ROWS=[4,4,5,5,2,6,6,3],i.PTS_INDEX=[0,2,4,5,10,7,9,11],i}(t._BaseSprite);t.Fruit=e}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e=.5;!function(t){t[t.IN_BOX=0]="IN_BOX",t[t.LEAVING_BOX=1]="LEAVING_BOX",t[t.CHASING_PACMAN=2]="CHASING_PACMAN",t[t.SCATTERING=3]="SCATTERING",t[t.BLUE=4]="BLUE",t[t.EYES=5]="EYES",t[t.EYES_ENTERING_BOX=6]="EYES_ENTERING_BOX"}(t.MotionState||(t.MotionState={}));var i=t.MotionState,s=function(s){function n(t,e,i){s.call(this,2),this.game=t,this._corner=new gtp.Point,this._spriteSheetY=e,this._exitDelaySeconds=i,this.reset()}return __extends(n,s),n.prototype.changeDirectionFallback=function(t){var e=this.moveAmount,i=gtp.Utils.randomInt(4);switch(i){case 0:this.goUpIfPossible(t,e)||this.goLeftIfPossible(t,e)||this.goRightIfPossible(t,e)||this.goDownIfPossible(t,e);break;case 1:this.goLeftIfPossible(t,e)||this.goUpIfPossible(t,e)||this.goDownIfPossible(t,e)||this.goRightIfPossible(t,e);break;case 2:this.goDownIfPossible(t,e)||this.goLeftIfPossible(t,e)||this.goRightIfPossible(t,e)||this.goUpIfPossible(t,e);break;case 3:this.goRightIfPossible(t,e)||this.goUpIfPossible(t,e)||this.goDownIfPossible(t,e)||this.goLeftIfPossible(t,e)}},n.prototype.continueInCurrentDirection=function(e){switch(this.direction){case t.Direction.NORTH:this.incY(-e);break;case t.Direction.WEST:this.incX(-e);break;case t.Direction.SOUTH:this.incY(e);break;case t.Direction.EAST:this.incX(e)}},n.prototype._getBlueTimeForLevel=function(t){switch(t){case 0:case 1:return 8e3;case 2:case 3:return 6e3;case 4:case 5:return 4e3;case 6:case 7:return 2e3;default:return 0}},n.prototype._getFirstExitDelayMillis=function(){return 1e3*this._exitDelaySeconds},n.prototype.getFrameCount=function(){return 2},Object.defineProperty(n.prototype,"motionState",{get:function(){return this._motionState},set:function(t){var e=this.game;if(t===i.SCATTERING)switch(this._scatterCount++){case 0:case 1:this._exitScatteringTime=e.playTime+7e3,this._motionState=t;break;case 2:case 3:this._exitScatteringTime=e.playTime+5e3,this._motionState=t;break;default:this._motionState=i.CHASING_PACMAN}else if(t===i.BLUE){var s=this._getBlueTimeForLevel(e.level),n=e.playTime;switch(this.exitBlueTime=n+s,this._motionState){case i.CHASING_PACMAN:this._previousState=this._motionState,this.startScatteringTime+=s;break;case i.SCATTERING:this._previousState=this._motionState,this._exitScatteringTime+=s;break;case i.BLUE:var o=this.exitBlueTime-n;switch(this._previousState){case i.CHASING_PACMAN:this.startScatteringTime+=o+s;break;case i.SCATTERING:this._exitScatteringTime+=o+s}break;default:throw new Error("Unexpected state: "+this._motionState)}this._motionState=t}else this._motionState===i.CHASING_PACMAN&&(this.startScatteringTime=e.playTime+2e4),this._motionState=t;this.game.checkLoopedSound()},enumerable:!0,configurable:!0}),n.prototype.getUpdateDelayMillis=function(){switch(this._motionState){case i.BLUE:return 25;case i.EYES:case i.EYES_ENTERING_BOX:return 10;default:return 10}},n.prototype.isBlue=function(){return this._motionState===i.BLUE},n.prototype.isEyes=function(){return this._motionState===i.EYES||this._motionState===i.EYES_ENTERING_BOX},n.prototype.paint=function(e){var s=this.bounds.x,n=this.bounds.y,o=t.PacmanGame.SPRITE_SIZE;switch(this._motionState){case i.BLUE:var a=(10+this.getFrame())*o,r=3*o,h=game.playTime;this.exitBlueTime-h<=1e3&&0!==(h/250&1)&&(r+=o),game.drawSprite(s,n,a,r);break;case i.EYES:case i.EYES_ENTERING_BOX:a=this.direction*o,r=4*o,game.drawSprite(s,n,a,r);break;default:a=this.direction*o*this.getFrameCount()+this.getFrame()*o,r=this._spriteSheetY,game.drawSprite(s,n,a,r)}},n.prototype.possiblyTurnBlue=function(){switch(this._motionState){case i.CHASING_PACMAN:case i.SCATTERING:case i.BLUE:return this.motionState=i.BLUE,!0;default:return!1}},n.prototype.reset=function(){s.prototype.reset.call(this),this._scatterCount=0},n.prototype.setCorner=function(t){this._corner.x=t.x,this._corner.y=t.y},n.prototype._updatePositionBlue=function(e){var i=this.moveAmount;if(this.atIntersection(e)){var s=game.pacman,n=s.row,o=s.column,a=this.row,r=this.column,h=!1;a===n&&e.isClearShotRow(a,r,o)?(this.goUpIfPossible(e,i)||this.goDownIfPossible(e,i)||(r>o?this.goRightIfPossible(e,i)||(this.direction=t.Direction.WEST,this.incX(-i)):this.goLeftIfPossible(e,i)||(this.direction=t.Direction.EAST,this.incX(i))),h=!0):r===o&&e.isClearShotColumn(r,a,n)&&(this.goLeftIfPossible(e,i)||this.goRightIfPossible(e,i)||(a>n?this.goDownIfPossible(e,i)||(this.direction=t.Direction.NORTH,this.incY(-i)):this.goUpIfPossible(e,i)||(this.direction=t.Direction.SOUTH,this.incY(i))),h=!0),h||this.changeDirectionFallback(e)}else this.continueInCurrentDirection(i);game.playTime>=this.exitBlueTime&&(this.motionState=this._previousState)},n.prototype._updatePositionEyes=function(e){var s=this.moveAmount;if(this.atIntersection(e)){var n=this.row,o=this.column,a=Math.floor((game.PENALTY_BOX_EXIT_Y+8)/t.PacmanGame.TILE_SIZE),r=Math.floor(game.PENALTY_BOX_EXIT_X/t.PacmanGame.TILE_SIZE);r>=o&&r++;var h=e.getPathBreadthFirst(n,o,a,r);null==h?this.motionState=i.EYES_ENTERING_BOX:h.col<o?(this.direction=t.Direction.WEST,this.incX(-s)):h.col>o?(this.direction=t.Direction.EAST,this.incX(s)):h.row<n?(this.direction=t.Direction.NORTH,this.incY(-s)):h.row>n&&(this.direction=t.Direction.SOUTH,this.incY(s))}else{var n=this.row,a=Math.floor((game.PENALTY_BOX_EXIT_Y+8)/t.PacmanGame.TILE_SIZE);n===a&&this.x===game.PENALTY_BOX_EXIT_X?this.motionState=i.EYES_ENTERING_BOX:this.continueInCurrentDirection(s)}},n.prototype._updatePositionEyesEnteringBox=function(s){var n=e,o=this.y;o<game.PENALTY_BOX_EXIT_Y+3*t.PacmanGame.SPRITE_SIZE/2?(this.direction=t.Direction.SOUTH,this.incY(n)):this.motionState=i.LEAVING_BOX},n.prototype.updatePositionImpl=function(t){switch(this._motionState){case i.IN_BOX:this.updatePositionInBox(t);break;case i.LEAVING_BOX:this.updatePositionLeavingBox(t);break;case i.SCATTERING:this.updatePositionScattering(t);break;case i.CHASING_PACMAN:this.updatePositionChasingPacman(t);break;case i.BLUE:this._updatePositionBlue(t);break;case i.EYES:this._updatePositionEyes(t);break;case i.EYES_ENTERING_BOX:this._updatePositionEyesEnteringBox(t)}},n.prototype.updatePositionInBox=function(s){var n=e;switch(this.direction){case t.Direction.WEST:case t.Direction.NORTH:this.y>112?this.incY(-n):this.direction=t.Direction.SOUTH;break;case t.Direction.EAST:case t.Direction.SOUTH:this.y<120?this.incY(n):this.direction=t.Direction.NORTH}game.playTime>=this._getFirstExitDelayMillis()&&(this.motionState=i.LEAVING_BOX)},n.prototype.updatePositionLeavingBox=function(s){var n=e,o=this.x;if(o<game.PENALTY_BOX_EXIT_X)this.direction=t.Direction.EAST,this.incX(n);else if(o>game.PENALTY_BOX_EXIT_X)this.direction=t.Direction.WEST,this.incX(-n);else{var a=this.y-n;this.y=a,a<=game.PENALTY_BOX_EXIT_Y?(a=game.PENALTY_BOX_EXIT_Y,this.motionState=i.SCATTERING,this.direction=t.Direction.WEST):this.direction=t.Direction.NORTH}},n.prototype.updatePositionScattering=function(e){var s=this.moveAmount;if(this.atIntersection(e)){var n=this.row,o=this.column,a=this._corner.x,r=this._corner.y,h=e.getPathBreadthFirst(n,o,a,r);h?h.col<o?(this.direction=t.Direction.WEST,this.incX(-s)):h.col>o?(this.direction=t.Direction.EAST,this.incX(s)):h.row<n?(this.direction=t.Direction.NORTH,this.incY(-s)):h.row>n&&(this.direction=t.Direction.SOUTH,this.incY(s)):this.changeDirectionFallback(e)}else this.continueInCurrentDirection(s);game.playTime>=this._exitScatteringTime&&(this.motionState=i.CHASING_PACMAN)},n}(t._BaseSprite);t.Ghost=s}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e=function(e){function i(i){e.call(this,i,0*t.PacmanGame.SPRITE_SIZE,0)}return __extends(i,e),i.prototype.reset=function(){e.prototype.reset.call(this),this.direction=t.Direction.WEST,this.setLocation(this.game.PENALTY_BOX_EXIT_X,this.game.PENALTY_BOX_EXIT_Y),this.motionState=t.MotionState.SCATTERING},i.prototype.updatePositionChasingPacman=function(e){var i=this.moveAmount;if(this.atIntersection(e)){var s=this.row,n=this.column,o=game.pacman.row,a=game.pacman.column,r=e.getPathBreadthFirst(s,n,o,a);null==r?this.changeDirectionFallback(e):r.col<n?(this.direction=t.Direction.WEST,this.incX(-i)):r.col>n?(this.direction=t.Direction.EAST,this.incX(i)):r.row<s?(this.direction=t.Direction.NORTH,this.incY(-i)):r.row>s&&(this.direction=t.Direction.SOUTH,this.incY(i))}else this.continueInCurrentDirection(i);game.playTime>=this.startScatteringTime&&(this.motionState=t.MotionState.SCATTERING)},i}(t.Ghost);t.Blinky=e}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e=function(e){function i(i){e.call(this,i,1*t.PacmanGame.SPRITE_SIZE,8)}return __extends(i,e),i.prototype.reset=function(){e.prototype.reset.call(this),this.direction=t.Direction.SOUTH,this.setLocation(12*t.PacmanGame.TILE_SIZE-t.PacmanGame.TILE_SIZE/2-4,15*t.PacmanGame.TILE_SIZE-t.PacmanGame.TILE_SIZE/2),this.motionState=t.MotionState.IN_BOX},i.prototype.updatePositionChasingPacman=function(e){var i=this.moveAmount;if(this.atIntersection(e)){var s=this.row,n=this.column,o=game.getGhost(0),a=o.row,r=o.column,h=(r-n)*(r-n)+(a-s)*(a-s);if(35>=h){var c=game.pacman.row,u=game.pacman.column,p=e.getPathBreadthFirst(s,n,c,u);null==p?this.changeDirectionFallback(e):p.col<n?(this.direction=t.Direction.WEST,this.incX(-i)):p.col>n?(this.direction=t.Direction.EAST,this.incX(i)):p.row<s?(this.direction=t.Direction.NORTH,this.incY(-i)):p.row>s&&(this.direction=t.Direction.SOUTH,this.incY(i))}else this.changeDirectionFallback(e)}else this.continueInCurrentDirection(i);game.playTime>=this.startScatteringTime&&(this.motionState=t.MotionState.SCATTERING)},i}(t.Ghost);t.Inky=e}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e=function(e){function i(i){e.call(this,i,2*t.PacmanGame.SPRITE_SIZE,2)}return __extends(i,e),i.prototype.reset=function(){e.prototype.reset.call(this),this.direction=t.Direction.NORTH,this.setLocation(14*t.PacmanGame.TILE_SIZE-t.PacmanGame.TILE_SIZE/2-4,15*t.PacmanGame.TILE_SIZE-t.PacmanGame.TILE_SIZE/2),this.motionState=t.MotionState.IN_BOX},i.prototype.updatePositionChasingPacman=function(e){var i=this.moveAmount,s=game.pacman,n=s.row,o=s.column,a=this.row,r=this.column,h=!1;this.atIntersection(e)?(a===n&&e.isClearShotRow(a,r,o)?(r>o?(this.direction=t.Direction.WEST,this.incX(-i)):this.goRightIfPossible(e,i)||this.changeDirectionFallback(e),h=!0):r===o&&e.isClearShotColumn(r,a,n)&&(a>n?(this.direction=t.Direction.NORTH,this.incY(-i)):this.goDownIfPossible(e,i)||this.changeDirectionFallback(e),h=!0),h||this.changeDirectionFallback(e)):this.continueInCurrentDirection(i),game.playTime>=this.startScatteringTime&&(this.motionState=t.MotionState.SCATTERING)},i}(t.Ghost);t.Pinky=e}(pacman||(pacman={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},pacman;!function(t){"use strict";var e=function(e){function i(i){e.call(this,i,3*t.PacmanGame.SPRITE_SIZE,14)}return __extends(i,e),i.prototype.reset=function(){e.prototype.reset.call(this),this.direction=t.Direction.SOUTH,this.setLocation(16*t.PacmanGame.TILE_SIZE-t.PacmanGame.TILE_SIZE/2-4,15*t.PacmanGame.TILE_SIZE-t.PacmanGame.TILE_SIZE/2),this.motionState=t.MotionState.IN_BOX},i.prototype.updatePositionChasingPacman=function(e){var i=this.moveAmount;this.atIntersection(e)?this.changeDirectionFallback(e):this.continueInCurrentDirection(i),game.playTime>=this.startScatteringTime&&(this.motionState=t.MotionState.SCATTERING)},i}(t.Ghost);t.Clyde=e}(pacman||(pacman={}));